# 随机数

本节我们讨论一个非常重要的元素 —— 随机数。

在虚拟世界的很多场景中都需要引入随机数，来让未来变得不可琢磨，激起我们探索的欲望。

> 想象你在玩游戏的时候，是不是每局都不尽相同呢？

那请问在`Solidity`里该如何生成随机数呢？

## keccak256

在`Solidity`中最好的随机数生成器是`keccak256`
    
我们可以通过如下代码生成0-100随机数：

```solidity
// 1、使用 keccak256 计算 now 时间戳的哈希值
// 2、转换成 uint 类型
// 3、对 100 取余
uint(keccak256(now)) % 100;
```

## 安全性分析

理想情况中，调用方会将执行智能合约的事务广播到以太坊网络中，

当已收集该事务的某一节点顺利的解决难题，发布区块时，智能合约事务执行结果也将尘埃落定。

但存在这样一种攻击的方式，

攻击者在隔离节点上执行智能合约并根据结果选择是否进行广播（解除隔离）

1. 如果执行结果对攻击者有利则尝试解决难题，当难题解决后发布区块进行广播
2. 如果执行结果对攻击者不利则重置状态到执行智能合约前

如此一来，便可以间接控制随机数为攻击者所用！🦹

所以[上面的方法](#keccak256)实际上非常的**不安全**

但因为解决难题的几率非常小，所以除非攻击的回报非常丰厚，

否则攻击者不会采用这种方式进行攻击。

## 拓展知识

话说回来，

到底是否存在在智能合约中安全生成随机数的方法呢？

答案是肯定的，

尽管困难，人们还是讨论出了[一些办法](https://ethereum.stackexchange.com/questions/191/how-can-i-securely-generate-a-random-number-in-my-smart-contract) 。